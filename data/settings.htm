<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/favicon.ico">
    <title>ESP RFID Websocket Demo</title>
    <!-- Bootstrap core CSS -->
    <link href="bootstrap.css" rel="stylesheet">
    <link href="jumbotron.css" rel="stylesheet">
    <script>
        var websock;

        function start() {
            websock = new WebSocket('ws://' + window.location.hostname + '/ws');
            websock.onopen = function(evt) {
                console.log('ESP WebSock Open');
            };
            websock.onclose = function(evt) {
                console.log('ESP WebSock Close');
            };
            websock.onerror = function(evt) {
                console.log(evt);
            };
            websock.onmessage = function(evt) {
                console.log(evt.data);
                var x;
                var select = document.getElementById('ssid');
                obj = JSON.parse(evt.data);
                for (var i = 0; i < obj.ssid.length; i++) {
                    x = obj.ssid[i];
                    var opt = document.createElement('option');
                    opt.value = x;
                    opt.innerHTML = x;
                    select.appendChild(opt);
                };
                document.getElementById('scanb').innerHTML = 'Re-Scan';
            };
        }

        function scanWifi() {
            websock.send('{command:"scan"}');
            document.getElementById('scanb').innerHTML = '......';
            document.getElementById('inputtohide').style.display = 'none';
            var node = document.getElementById('ssid');
            node.style.display = 'inline';
            while (node.hasChildNodes()) {
                node.removeChild(node.lastChild);
            };
        }
        
        function joinWifi() {
          var ssid;
          if (document.getElementById('inputtohide').style.display == 'none' ) {
              var b = document.getElementById("ssid");
              ssid = b.options[b.selectedIndex].value;
          }
          else {ssid = document.getElementById('inputtohide').value}
          var passwd = document.getElementById('wifipass').value
          var datatosend = {};
          datatosend.command = "setssid";
          datatosend.ssid = ssid;
          datatosend.pswd = passwd;
          console.log(datatosend);
          websock.send(JSON.stringify(datatosend));
        }
    </script>
</head>

<body onload="javascript:start();">
    <div class="container">
        <div class="header clearfix">
            <nav>
                <ul class="nav nav-pills pull-right">
                    <li role="presentation"><a href="index.htm">Home</a> </li>
                    <li role="presentation" class="active"><a href="settings.htm">Settings</a> </li>
                </ul>
            </nav>
            <h3 class="text-muted">ESP RFID</h3> </div>
        <div class="jumbotron">
            <div class="alert alert-warning"> <strong>Warning!</strong> Saving settings will cause your ESP to reboot. </div>
            <fieldset>
                <legend>Wi-Fi Client Settings</legend>
                <p style="font-size:12px;" class="text-muted">Type your Wi-Fi Network's SSID or Scan for nerby Wireless Networks to join.</p>
                <div class="row form-group">
                    <label class="col-xs-3">SSID</label> 
                    <span class="col-xs-9">
                          <input class="form-control input-sm" style="display:inline;max-width:185px" id="inputtohide" type="text" name="ap_ssid"/>
                          <select class="form-control input-sm" style="display:none;max-width:185px" id="ssid"></select>
                          <button id="scanb" type="button" class="btn btn-info btn-xs" onclick="scanWifi()">Scan</button>
                          
</span>
                          </div>
                <div class="row form-group">
                    <label class="col-xs-3">Password</label> 
                    <span class="col-xs-9">
                        <input id="wifipass" style="max-width:185px" class="form-control input-sm" type="text" name="ap_passwd">
                        </span> 
                        </div>
                                    <div>
                <button id="join" class="btn btn-warning btn-sm pull-right" onclick="joinWifi()"> Reboot & Join</button>
                </div>
            </fieldset>
            <br>
            <fieldset>
                <legend>Administrator Credentials</legend>
                <p style="font-size:12px;" class="text-muted">NOT IMPLEMENTED YET. Configure User Name and Password for both Settings Menu and HTML Editor.</p>
                <div class="row form-group">
                    <label for="username" class="col-xs-3">User Name</label> <span class="col-xs-9">
                    <input id="username" class="form-control input-sm" style="max-width:185px" type="text" name="username" />
                    </span> </div>
                <div class="row form-group">
                    <label class="col-xs-3">Password</label> <span class="col-xs-9">
                        <input class="form-control input-sm" style="max-width:185px" type="text" name="admin_passwd">
                        </span> </div>
                        
            </fieldset>
            <br>
            <fieldset>
                <legend>MFRC522 Hardware Settings</legend>
                <p style="font-size:12px;" class="text-muted">NOT IMPLEMENTED YET. Please refer documentation for more information.</p>
                <div class="row form-group">
                    <label class="col-xs-3">SS_PIN</label> <span class="col-xs-9">
                        <select class="form-control input-sm" style="max-width:185px" id="gpioss">
                          <option value="0">GPIO-0</option>
                          <option value="2">GPIO-2</option>
                          <option value="4">GPIO-4</option>
                          <option value="5">GPIO-5</option>
                          <option value="15">GPIO-15</option>
                          <option value="16">GPIO-16</option>
                        </select>
                    </span> </div>
                <div class="row form-group">
                    <label class="col-xs-3">RST_PIN</label> <span class="col-xs-9">
                        <select class="form-control input-sm" style="max-width:185px" id="gpiorst">
                          <option value="0">GPIO-0</option>
                          <option value="2">GPIO-2</option>
                          <option value="4">GPIO-4</option>
                          <option value="5">GPIO-5</option>
                          <option value="15">GPIO-15</option>
                          <option value="16">GPIO-16</option>
                        </select>
                        </span> 
                        
        
                        </div>
                        <div class="row form-group">
                          
                          <label class="col-xs-3">Antenna Gain</label> <span class="col-xs-9">
                          <select class="form-control input-sm" style="max-width:185px" id="gain">
                          <option value="RxGain_48dB">Max (48 db)</option>
                          <option value="RxGain_43dB">43 db</option>
                          <option value="RxGain_38dB">38 db</option>
                          <option value="RxGain_33dB">Avg (33 db)</option>
                          <option value="RxGain_23dB">23 db</option>
                          <option value="RxGain_18dB">Min (18 db)</option>
                        </select>
                        </span> 
                           </div>
                           
                                                   <div class="row form-group">
                          
                          <label class="col-xs-3">PICC Password</label>
                                              <span class="col-xs-9">
                        <input style="max-width:185px" class="form-control input-sm" type="text" name="piccpasswd">
                        </span> 
                           </div>
            </fieldset>
                        <br>
            <fieldset>
                <legend>NTP Client Settings</legend>
                <p style="font-size:12px;" class="text-muted">NOT IMPLEMENTED YET. Configure NTP Clients Settings.</p>
                <div class="row form-group">
                    <label class="col-xs-3">Server</label> <span class="col-xs-9">
                    <input class="form-control input-sm" style="max-width:185px" type="text" name="ntpserver" />
                    </span> </div>
                <div class="row form-group">
                    <label class="col-xs-3">Intervals</label> <span class="col-xs-9">
                        <input class="form-control input-sm" style="max-width:185px" type="text" name="ntpinterval">
                        </span> </div>
            </fieldset>
            <br>
            <div>
                <input type="submit" name="save_reboot" value="Save &amp; reboot" class="btn btn-success btn-md pull-right"> </div>
                <br>
        </div>
        <footer class="footer">
            <p>&copy; 2017 OSB Inc.</p>
        </footer>
    </div>
</body>

</html>